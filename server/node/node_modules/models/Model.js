require("prototypes");

var Model = function() {
	var attr, def, value;
	var d, depth;
	for(attr in this.constructor.model)
	{
		def = this.constructor.model[attr].def;
		if(def == null)
		{
			continue;
		}
		
		attr = attr.split(".");
		depth = attr.length;
		
		value = this;
		for(d=0;d<depth-1;d++)
		{
			if(value[attr[d]] == null)
			{
				value[attr[d]] = {};
			}
			value = value[attr[d]];
		}
		if(value[attr[d]] == null)
		{
			value[attr[d]] = def;
		}
	}
};
Model.model = {};
Model.prototype.validate = function() {
	var attr, field, value;
	var d, depth;
	for(attr in this.constructor.model)
	{
		field = this.constructor.model[attr];
		if(field.type == null)
		{
			continue;
		}
		
		attr = attr.split(".");
		depth = attr.length;
		
		value = this;
		for(d=0;d<depth-1;d++)
		{
			if(value[attr[d]] == null)
			{
				return false;
			}
			value = value[attr[d]];
		}
		if(value != null)
		{
			if(!field.type(value))
			{
				return false;
			}
		} else if(field.required)
		{
			return false;
		}
	}
	return true;
};
module.exports = exports = Model;