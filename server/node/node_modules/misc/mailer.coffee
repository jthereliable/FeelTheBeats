require "coffee-script"

EMAIL_REGEX = /^(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){255,})(?!(?:(?:\x22?\x5C[\x00-\x7E]\x22?)|(?:\x22?[^\x5C\x22]\x22?)){65,}@)(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22))(?:\.(?:(?:[\x21\x23-\x27\x2A\x2B\x2D\x2F-\x39\x3D\x3F\x5E-\x7E]+)|(?:\x22(?:[\x01-\x08\x0B\x0C\x0E-\x1F\x21\x23-\x5B\x5D-\x7F]|(?:\x5C[\x00-\x7F]))*\x22)))*@(?:(?:(?!.*[^.]{64,})(?:(?:(?:xn--)?[a-z0-9]+(?:-[a-z0-9]+)*\.){1,126}){1,}(?:(?:[a-z][a-z0-9]*)|(?:(?:xn--)[a-z0-9]+))(?:-[a-z0-9]+)*)|(?:\[(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){7})|(?:(?!(?:.*[a-f0-9][:\]]){7,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,5})?)))|(?:(?:IPv6:(?:(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){5}:)|(?:(?!(?:.*[a-f0-9]:){5,})(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3})?::(?:[a-f0-9]{1,4}(?::[a-f0-9]{1,4}){0,3}:)?)))?(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))(?:\.(?:(?:25[0-5])|(?:2[0-4][0-9])|(?:1[0-9]{2})|(?:[1-9]?[0-9]))){3}))\]))$/i
exports.isEmail = (email) ->
  EMAIL_REGEX.test email

DOMAIN_REGEX = /@(.*)$/;
exports.getDomain = (email) ->
  out = email.match DOMAIN_REGEX
  if out == null then null else out[1]

THROWAWAYS = ["0-mail.com","0815.ru","0clickemail.com","10minutemail.com","20minutemail.com","2prong.com","30minutemail.com","3d-painting.com","4warding.com","4warding.net","4warding.org","60minutemail.com","amilegit.com","anonbox.net","anonymbox.com","antispam.de","beefmilk.com","binkmail.com","bio-muesli.net","bobmail.info","bofthew.com","brefmail.com","bsnow.net","bugmenot.com","bumpymail.com","cosmorph.com","courrieltemporaire.com","cubiclink.com","curryworld.de","cust.in","dacoolest.com","dandikmail.com","dayrep.com","deadaddress.com","despam.it","devnullmail.com","discardmail.com","discardmail.de","disposemail.com","dispostable.com","dodgeit.com","dodgit.com","dodgit.org","donemail.ru","dontreg.com","dontsendmespam.de","dump-email.info","dumpyemail.com","e4ward.com","email60.com","emailigo.de","emailinfive.com","emailmiser.com","emailsensei.com","emailtemporario.com.br","emailwarden.com","emailx.at.hm","fakeinbox.com","fakeinformation.com","fastacura.com","filzmail.com","fizmail.com","fr33mail.info","get1mail.com","get2mail.fr","getonemail.com","getonemail.net","gishpuppy.com","great-host.in","guerillamail.com","guerrillamail.com","guerrillamailblock.com","h.mintemail.com","haltospam.com","hochsitze.com","hotpop.com","hulapla.de","ieatspam.eu","ieatspam.info","imails.info","incognitomail.com","incognitomail.net","incognitomail.org","insorg-mail.info","ipoo.org","jetable.com","jetable.net","jetable.org","jnxjn.com","junk1e.com","keepmymail.com","kir.ch.tc","klzlk.com","kulturbetrieb.info","lhsdv.com","litedrop.com","lol.ovpn.to","lookugly.com","lopl.co.cc","m4ilweb.info","mail-temporaire.fr","mail.by","mail4trash.com","mailcatch.com","maileater.com","mailexpire.com","mailin8r.com","mailinator.com","mailinator.net","mailinator2.com","mailme.ir","mailme.lv","mailmetrash.com","mailnator.com","mailnesia.com","mailnull.com","mailslite.com","mailzilla.org","mbx.cc","meltmail.com","messagebeamer.de","mierdamail.com","mintemail.com","moburl.com","monemail.fr.nf","msa.minsmail.com","mt2009.com","mypartyclip.de","myphantomemail.com","mytrashmail.com","nepwk.com","no-spam.ws","nobulk.com","noclickemail.com","nogmailspam.info","nomail2me.com","nomorespamemails.com","nospam4.us","nospamfor.us","nospamthanks.info","notmailinator.com","nowmymail.com","nus.edu.sg","nwldx.com","onewaymail.com","online.ms","ovpn.to","owlpic.com","pjjkp.com","politikerclub.de","pookmail.com","prtnx.com","qq.com","quickinbox.com","recode.me","regbypass.com","rmqkr.net","rppkn.com","rtrtr.com","s0ny.net","safe-mail.net","safetymail.info","safetypost.de","sandelf.de","saynotospams.com","selfdestructingmail.com","sendspamhere.com","sharklasers.com","shitmail.me","skeefmail.com","slopsbox.com","smellfear.com","snakemail.com","sofimail.com","sofort-mail.de","sogetthis.com","spam.la","spam.su","spamavert.com","spambob.net","spambob.org","spambog.com","spambog.de","spambog.ru","spambox.info","spambox.irishspringrealty.com","spambox.us","spamcero.com","spamday.com","spamfree24.com","spamfree24.de","spamfree24.eu","spamfree24.info","spamfree24.net","spamfree24.org","spamgourmet.com","spamherelots.com","spamhole.com","spamify.com","spaminator.de","spamkill.info","spaml.com","spaml.de","spammotel.com","spamobox.com","spamspot.com","spamthis.co.uk","spamthisplease.com","supergreatmail.com","supermailer.jp","suremail.info","teewars.org","teleworm.com","teleworm.us","tempalias.com","tempe-mail.com","tempemail.biz","tempemail.com","tempemail.net","tempinbox.co.uk","tempinbox.com","tempmail.it","tempmail2.com","tempomail.fr","temporarioemail.com.br","temporaryemail.net","temporaryinbox.com","thanksnospam.info","thankyou2010.com","thisisnotmyrealemail.com","throwawayemailaddress.com","tmailinator.com","tradermail.info","trash-amil.com","trash-mail.com","trash-mail.de","trash2009.com","trashemail.de","trashmail.at","trashmail.com","trashmail.net","trashmail.ws","trashmailer.com","trashymail.com","trashymail.net","trillianpro.com","tyldd.com","uggsrock.com","veryrealemail.com","webm4il.info","wegwerfemail.de","wh4f.org","whyspam.me","willselfdestruct.com","wuzupmail.net","yopmail.com","yuurok.com","zehnminutenmail.de","zippymail.info","zoaxe.com"]
exports.isThrowAway = (email) ->
  domain = exports.getDomain email
  domain == null || THROWAWAYS.indexOf(domain.toLowerCase())>-1