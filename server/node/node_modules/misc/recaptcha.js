var settings			= require("settings"),
	http				= require("http"),
	querystring			= require("querystring"),
	recaptcha_keys		= require(settings.security.recaptcha.key_path);

exports.verify = function(ip, challenge, response, callback) {
	// ip = req.connection.remoteAddress
	
	var data = querystring.stringify({
		"privatekey": recaptcha_keys.private_key,
		"remoteip": ip,
		"challenge": challenge,
		"response": response
	});
	
	http.request({
		"host": settings.security.recaptcha.endpoint.host,
		"path": settings.security.recaptcha.endpoint.path,
		"method": "POST",
		"headers": {
			"Content-Type": "application/x-www-form-urlencoded",
			"Content-Length": data.length
		}
	}, function(res) {
		res.setEncoding("utf8");
		var response = "";
		res.on("data", function(chunk) {
			response += chunk;
		}).on("end", function() {
			response = response.split("\n");
			if(String(response.shift()) == "true")
			{
				callback(null, true);
				return;
			}
			callback(response.join("\n"), false);
		});
	}).on("error", function(error) {
		emitter.emit("error",error);
	}).end(data);
};