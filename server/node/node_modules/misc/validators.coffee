require "coffee-script"

moment = require "moment"

isEmpty = exports.isEmpty = (test) ->
  !test?

isNumber = exports.isNumber = (test) ->
  !test? && !isNaN(test)

isInt = exports.isInt = (test) ->
  !test? && isNumber(test) && test%1==0

isPositive = exports.isPositive = (test) ->
  !test? && isNumber(test) && test>0

isPositive = exports.isNegative = (test) ->
  !test? && isNumber(test) && test<0

isDate = exports.isDate = (test) ->
  !test? && moment(test).isValid()

date = exports.date = (test, min_date, max_date) ->
  min_date = if min_date? then moment(String(min_date)) else 0
  max_date = if max_date? then moment(String(max_date)) else Infinity
  min_date = if min_date.isValid? && min_date.isValid() then +min_date else 0
  max_date = if max_date.isValid? && max_date.isValid() then +max_date else Infinity

  test = moment(test)
  !(!isDate(test) || +test<min_date || +test>max_date)

string = exports.string = (test, min_length=0, max_length=Infinity) ->
  return !(isEmpty(test) || test.length<min_length || test.length>max_length)

number = exports.number = (test, min=-Infinity, max=Infinity) ->
  return !(!isNumber(test) || test<min || test>max)

int = exports.int = (test, min=-Infinity, max=Infinity) ->
  return !(!isInt(test) || test<min || test>max)

email = exports.email = require("misc/mailer").isEmail

object = exports.object = (test) ->
  !(test instanceof Array || !(test instanceof Object))

array = exports.array = (test, min=0, max=Infinity) ->
  return !(!(test instanceof Array) || test.length<min || test.length>max)