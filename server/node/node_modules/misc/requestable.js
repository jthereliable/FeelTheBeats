var __					= require("underscore"),
	mysql				= require("database/mysql.js");

var where = exports.where = function(req, query) {
	var keys = __.keys(query);
	var params = __.extend(__.pick(req.query || {}, keys), __.pick(req.body || {}, keys), __.pick(req.params || {}, keys));
	if(__.isEmpty(params))
	{
		return " WHERE 1 ";
	}
	
	var out = [];
	var i, f, v;
	for(i in params)
	{
		f = query[i].name || i;
		if(query[i].string)
		{
			out.push(mysql.escapeId(f) + " LIKE " + mysql.escape(params[i]+"%"));
		} else {
			out.push(mysql.escapeId(f) + " = " + mysql.escape(params[i]));
		}
	}
	return " WHERE " + out.join(" AND ")+" ";
};
var limits = exports.limits = function(req, orderable, limit) {
	limit = limit || 25;
	
	var order = req.query.order || orderable[0];
	var sort = (req.query.sort || "ASC").toUpperCase() == "ASC"?"ASC":"DESC";
	var offset = req.query.offset|0 || 0;
	var limit = req.query.limit|0 || limit;
	
	if(orderable.indexOf(order) == -1)
	{
		order = orderable[0];
	}
	
	return " ORDER BY "+mysql.escapeId(order)+" "+sort+" LIMIT "+offset+", "+limit+" ";
};