var __					= require("underscore"),
	mysql				= require("database/mysql.js");

var where = exports.where = function(req, query, query_string) {
	var params = __.extend(__.pick(req.query || {}, query), __.pick(req.body || {}, query), __.pick(req.params || {}, query));
	if(__.isEmpty(params))
	{
		return "1";
	}
	
	var out = [];
	var i;
	for(i in params)
	{
		if(__.indexOf(query_string, i) > -1)
		{
			out.push(mysql.escapeId(i) + " LIKE " + mysql.escape(params[i]+"%"));
		} else {
			out.push(mysql.escapeId(i) + " = " + mysql.escape(params[i]));
		}
	}
	return out.join(" AND ");
};
var limits = exports.limits = function(req, orderable, limit) {
	limit = limit || 25;
	
	var order = req.query.order || orderable[0];
	var sort = (req.query.sort || "ASC").toUpperCase() == "ASC"?"ASC":"DESC";
	var offset = req.query.offset|0 || 0;
	var limit = req.query.limit|0 || limit;
	
	if(orderable.indexOf(order) == -1)
	{
		order = orderable[0];
	}
	
	return {
		"order": order,
		"sort": sort,
		"offset": offset,
		"limit": limit
	}
};