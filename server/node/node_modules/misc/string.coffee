require "coffee-script"

# Random String Generator
exports.random = (n) ->
  s = ""
  while n>0
    s += String.fromCharCode(Math.floor(Math.random() * (127 - 32)) + 32)
    --n
  s

RAND_URLSAFE_CHARSET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789.-_~"
exports.random_urlsafe = (l) ->
  s = ""
  n = RAND_URLSAFE_CHARSET.length
  while l>0
    s += RAND_URLSAFE_CHARSET[n*Math.random()|0]
    --l
  s

RAND_ALPHANUM_CHARSET = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789"
exports.random_alphanum = (l) ->
  s = ""
  n = RAND_ALPHANUM_CHARSET.length
  while l>0
    s += RAND_ALPHANUM_CHARSET[n*Math.random()|0]
    --l
  s

RAND_LETTERS_CHARSET = "abcdefghijklmnopqrstuvwxyz"
exports.random_letters = (l) ->
  s = ""
  n = RAND_LETTER_CHARSET.length
  while l>0
    s += RAND_LETTER_CHARSET[n*Math.random()|0]
    --l
  s

# String Fixifiers
unorm = require "unorm"
exports.removeAccents = (str) ->
  unorm.nfkd(str)

REMOVE_SYMBOLS_REGEX = /[^a-zA-Z_0-9 \.\,\:\(\)\[\]\-\+\=\'\"\/\\\{\}\!\@\#\$\%\^\&\*\?\<\>\;]/g
exports.removeSymbols = (str) ->
  str.replace REMOVE_SYMBOLS_REGEX, ""

# Format Checking
exports.isEmail = require("misc/mailer").isEmail